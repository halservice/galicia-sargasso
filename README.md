# Galicia
GALICIA is a project funded by the European Union, within the framework of the [NGI Sargasso](https://ngisargasso.eu/).

The aim of the project is to test a novel approach to **digital resilience** verification by testing LLM generated code for correctness and security on a set of case studies, aiming to ensure compliance with user requirements and given standards. 
The ambition is to verify source code generated by Generative AI and analyze its limits, thus **_building trust in Generative AI_**. 

[Learn More](https://www.galicia-project.eu/)

---
## Requirements
    PHP: ^8.2

    Framework: Laravel v11

    Docker & Docker Compose

----

## Project Set-Up

#### Create a `.env` file by copying the example file.

#### Fill in the following environment variables:

```
OPENAI_API_KEY=

# Canadian partner
MINDINABOX_API_KEY=
MINDINABOX_BASE_URI=
MINDINABOX_MODEL=
```

If needed, change `APP_PORT` to use a different port.

#### Install Laravel Sail
```
composer require laravel/sail --dev --ignore-platform-reqs
php artisan sail:install
```
> **Note:** The `--ignore-platform-reqs` option is used because Laravel Sail handles the required PHP extensions within the Docker containers.

When prompted, select `pgsql` as the database.

#### Start the Sail environment
```
sail up -d
```
#### Install the dependencies
```
sail composer install
sail npm install
```
#### Generate the application key
```
sail artisan key:generate
```
#### Rebuild the Containers (optional)
Useful if you're experiencing cache-related issues.
```
sail down --volumes
sail build --no-cache
sail up -d
```
#### Run the database migrations
```
sail artisan migrate
```

_Your application should now be running at http://localhost:8000_


---
## Database Schema

Galicia uses a PostgreSQL database composed of several key tables. Below is a high-level overview of the main entities and their relationships.

### `users`

Stores user account data.

| Field          | Type      | Description                 |
|----------------|-----------|-----------------------------|
| id             | UUID      | Primary key                 |
| username       | VARCHAR   | User name                   |
| email          | VARCHAR   | Unique user email address   |
| is_admin       | BOOLEAN   | Admin flag (default: false) |
| password       | TEXT      | Hashed password             |
| remember_token | BOOLEAN   | Admin flag (default: false) |
| created_at     | TIMESTAMP | Account creation timestamp  |
| updated_at     | TIMESTAMP | Last update timestamp       |

---

### `generated_codes`

Stores requirements and the generated code from the user.

| Field                     | Type      | Description                             |
|---------------------------|-----------|-----------------------------------------|
| id                        | UUID      | Primary key                             |
| user_id                   | UUID      | Foreign key to `users`                  |
| generated_formal_model_id | UUID      | Nullable FK to `generated_code`         |
| requirement               | TEXT      | Requirement text submitted by user      |
| generated_code            | TEXT      | LLM-generated code                      |
| system_message            | TEXT      | System prompt                           |
| programming_language      | VARCHAR   | Selected language                       |
| llm_used                  | VARCHAR   | LLM identifier                          |
| is_active                 | BOOLEAN   | Used to track current/active generation |
| created_at                | TIMESTAMP | Generation timestamp                    |
| updated_at                | TIMESTAMP | Last update timestamp                   |

---

### `formal_models`

Represents the formal model generated either from the requirement or the code.

| Field                  | Type      | Description                                     |
|------------------------|-----------|-------------------------------------------------|
| id                     | UUID      | Primary key                                     |
| user_id                | UUID      | Foreign key to `users`                          |
| generated_code_id      | UUID      | Nullable FK to `generated_formal_model`         |
| requirement            | TEXT      | Requirement text submitted by user              |
| generated_formal_model | TEXT      | Generated formal model                          |
| system_message         | TEXT      | System prompt                                   |
| model_tool             | VARCHAR   | Name of formal model tool used for formal model |
| llm_used               | VARCHAR   | LLM used                                        |
| is_active              | BOOLEAN   | Used to track current/active generation         |
| created_at             | TIMESTAMP | Generation timestamp                            |
| updated_at             | TIMESTAMP | Last update timestamp                           |

---

### `validated_codes`

Stores the results of iterative validation of generated code.

| Field         | Type      | Description                                         |
|---------------|-----------|-----------------------------------------------------|
| id            | UUID      | Primary key                                         |
| user_id       | UUID      | Foreign key to `users`                              |
| system_message | TEXT      | System prompt                                       |
| validation_process | JSON      | JSON validation process                             |
| test_cases    | TEXT      | Generated test cases                                |
| validated_code | TEXT      | Final validated code                                |
| tests_result  | TEXT      | Test cases result                                   |
| iteration     | INTEGER   | Maximum iteration threshold                         |
| llm_used      | VARCHAR   | LLM used                                            |
| is_active     | BOOLEAN   | Used to track current/active validation             |
| generator_type | VARCHAR   | Polymorphic type (`FormalModel` or `GeneratedCode`) |
| generator_id  | UUID      | ID of the related generation                        |
| created_at    | TIMESTAMP | Validation timestamp                                
| updated_at    | TIMESTAMP | Last update timestamp                               |

### Table Relationships

The database schema supports flexible workflows where the process may begin either from a generated code or a formal model. This flexibility explains why some foreign keys are nullable.
- `generated_codes.generated_formal_model_id` (nullable): Set only if a **formal model** is generated *before* the code.

- `formal_models.generated_code_id` (nullable): Set only if the **code** is generated *before* the formal model.

- `validated_codes` uses a **polymorphic relation** (`generator_type` + `generator_id`): Links to either a `generated_code` or a `formal_model`, depending on where the validation process started. 
If the process starts from a `generated_code`, the `formal_model` is saved in the polymorphic relation and the original code remains traceable via `formal_models.generated_code_id`.
Conversely, if the process starts from a `formal_model`, the `generated_code` is saved in the polymorphic relation and the model remains traceable via `generated_codes.generated_formal_model_id`.

This relational design allows full traceability of the generation and validation pipeline in both directions.


## License

This project is licensed under the [GNU General Public License v3.0](https://www.gnu.org/licenses/gpl-3.0.en.html).

Â© 2025 Hal Service S.P.A.
